IWitness.spaceAndTime = Ember.Object.create({
  init: function() {
    var self = this;

    $.getJSON("<%= asset_path 'timezones.json' %>", function(zones){
      self.set('kdTree', new KDTree(zones));
    });

    $.getJSON("<%= asset_path 'zone_offsets.json' %>", function(zones){
      self.set('zoneOffsets', zones);
    });
  },

  utcOffset: function(point) {
    if (this.get('isLoaded')){
      var zone = this.get('kdTree').getNearestNeighbour({x:point[0], y:point[1]});
      return this.get('zoneOffsets')[zone.z];
    } else {
      return 0;
    }
  },

  isLoaded: function() {
    return this.get('kdTree') && this.get('zoneOffsets');
  }.property('kdTree', 'zoneOffsets')
});
