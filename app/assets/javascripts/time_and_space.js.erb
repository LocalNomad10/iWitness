(function(module){
  var kdTree, zoneOffsets;

  $.getJSON("<%= asset_path 'timezones.json' %>", function(zones){
    kdTree = new KDTree(zones);
  });

  $.getJSON("<%= asset_path 'zone_offsets.json' %>", function(zones){
    zoneOffsets = zones;
  });

  module.utcOffset = function(point){
    if ( !kdTree || !zoneOffsets ) {
      console && console.log && console.log("Time zones are not loaded yet");
      return 0;
    }
    var zone = kdTree.getNearestNeighbour({x:point[0], y:point[1]});
    return zoneOffsets[zone.z];
  }
})(window);
