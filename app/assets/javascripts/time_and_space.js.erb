(function(module){
  var kdTree, zoneOffsets;

  $(function(){
    $.getJSON("<%= asset_path 'timezones.json' %>", function(zones){
      console.log("got %s zones!", zones.length);
      kdTree = new KDTree(zones);
    });

    $.getJSON("<%= asset_path 'zone_offsets.json' %>", function(zones){
      console.log("got zone offsets!");
      zoneOffsets = zones;
    });
  });

  module.utcOffset = function(point){
    if ( !kdTree || !zoneOffsets ) throw "Time zones are not loaded yet";
    var zone = kdTree.getNearestNeighbour({x:point[0], y:point[1]});
    return zoneOffsets[zone.z];
  }
})(window);